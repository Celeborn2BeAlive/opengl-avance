

<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="icon" href="../../../../favicon.ico">

    <title>Percentage Closest Filtering - OpenGL Avancé</title>

    
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.3/css/bootstrap.min.css" integrity="sha384-Zug+QiDoJOrZ5t4lssLdxGhVrurbmBWopoEl+M6BdEfwnCJZtKxi1KgxUyJq13dy" crossorigin="anonymous">

    <style>
        body
        {
          font-family: "Work Sans", "Helvetica", "Tahoma", "Geneva", "Arial", sans-serif;
          color: #444444;
        }

        main
        {
          height:100vh;
          margin-top: 56px;;
        }

        h1, h2, h3, h4, h5, h6
        {
          margin: 2.5rem 0 1.5rem 0;
        }

        h1.section-title
        {
          font-family: "Novacento Sans Wide", "Helvetica", "Tahoma", "Geneva", "Arial", sans-serif;
          text-align: center;
          text-transform: uppercase;
          font-size: 3.25rem;
          margin: 1.0rem 0 1.5rem 0;
          font-weight: 200;
        }

        main a:hover
        {
          text-decoration: none;
        }

        main table
        {
          width: 100%;
          margin-bottom: 1rem;
        }

        main img
        {
          width: 100%;
        }

        .jumbotron
        {
          background-color: #EEEEEE;
        }

        .page-content
        {
          padding-top: 16px;
          padding-bottom: 1.5rem;
        }

        .main-article
        {
          margin-left: 15%;
          margin-right: 15%;
        }

        .middle-content
        {
          text-align: justify;
        }

        .side-menu
        {
          background-color: #EEEEEE;
          position: fixed;
          width: 15%;
          height: 100%;
          font-size: 1.0em;
          padding-left: 0px;
          padding-right: 0px;
        }

        .side-menu li li
        {
          font-size: 0.9em;
          width: 100%;
        }

        .side-menu a
        {
          color: #555555;
          font-weight: bold;
        }

        .side-menu a:hover
        {
          color: #CCCCCC;
          background-color: #343A40;
        }

        .side-menu-left
        {
          left: 0px;
        }

        .side-menu-right
        {
          right: 0px;
        }

        .highlight
        {
          margin-bottom: 1rem;
        }

        .highlight pre
        {
          margin: auto;
          padding: 1% 5% 1% 5%;
        }
    </style>
</head>

<body>

<nav class="navbar navbar-expand-md navbar-dark fixed-top bg-dark">
  <a class="navbar-brand" href="https://Celeborn2BeAlive.github.io/opengl-avance/">OpenGL Avancé</a>
  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarsExampleDefault" aria-controls="navbarsExampleDefault" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  <div class="collapse navbar-collapse" id="navbarsExampleDefault">
    <ul class="navbar-nav mr-auto">
        
            <li class="nav-item">
                <a class="nav-link" href="https://Celeborn2BeAlive.github.io/opengl-avance/01-introduction/introduction">Introduction</a>
            </li>
        
            <li class="nav-item">
                <a class="nav-link" href="https://Celeborn2BeAlive.github.io/opengl-avance/02-forward-renderer/pipeline">Forward Renderer</a>
            </li>
        
            <li class="nav-item">
                <a class="nav-link" href="https://Celeborn2BeAlive.github.io/opengl-avance/03-deferred-renderer/pipeline">Deferred Renderer</a>
            </li>
        
            <li class="nav-item active">
                <a class="nav-link" href="https://Celeborn2BeAlive.github.io/opengl-avance/04-shadow-mapping/introduction">Shadow Mapping</a>
            </li>
        
            <li class="nav-item">
                <a class="nav-link" href="https://Celeborn2BeAlive.github.io/opengl-avance/05-post-processing/introduction">Post Processing</a>
            </li>
        
            <li class="nav-item">
                <a class="nav-link" href="https://Celeborn2BeAlive.github.io/opengl-avance/06-course/opengl-context">Cours et Doc</a>
            </li>
        



      
    </ul>
  </div>
</nav>

<main role="main" class="main-article">

<div class="container-fluid">
    <div class="row">
        <div class="col side-menu side-menu-left page-content">
            <ul class="nav flex-column">
    
        <li class="nav-item">
            <a class="nav-link" href="https://Celeborn2BeAlive.github.io/opengl-avance/04-shadow-mapping/introduction/">Introduction</a>
        </li>
    
        <li class="nav-item">
            <a class="nav-link" href="https://Celeborn2BeAlive.github.io/opengl-avance/04-shadow-mapping/dir-shadow-map/">Directional Shadow Map</a>
        </li>
    
        <li class="nav-item">
            <a class="nav-link" href="https://Celeborn2BeAlive.github.io/opengl-avance/04-shadow-mapping/percentage-closest-filtering/">Percentage Closest Filtering</a>
        </li>
    
        <li class="nav-item">
            <a class="nav-link" href="https://Celeborn2BeAlive.github.io/opengl-avance/04-shadow-mapping/aller-plus-loin/">Aller plus loin</a>
        </li>
    
</ul>
        </div>

        <div class="col middle-content page-content">
            <h1 class="section-title">Percentage Closest Filtering</h1>

            

<h1 id="percentage-closest-filtering">Percentage Closest Filtering</h1>

<h2 id="basique">Basique</h2>

<p>L&rsquo;aspect visuel du shadow mapping dépend grandement de la résolution choisie. Pour une résolution de 512, vous avez du constater que le rendu des ombres est très aliasé. Il faut monter à 4096 au moins pour ne plus voir l&rsquo;aliasing à une distance correcte, qui reste très visible en se rapprochant.</p>

<p>Une manière de palier à cet aliasing est d&rsquo;utiliser une méthode de filtrage appelée <em>Percentage Closest Filtering</em>, qui consiste à moyenner la visibilité dans un voisinage du point afin de flouter/bruiter les ombres sur leur bord.</p>

<p>Cette technique est en partie supportée par le GPU en passant par un sampler de type <em>sampler2DShadow</em> en GLSL.</p>

<p>Dans <em>shadingPass.fs.glsl</em>, remplacez la déclaration des uniformes du shadow mapping par:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-glsl" data-lang="glsl"><span style="color:#66d9ef">uniform</span><span style=""> </span><span style="">mat4</span><span style=""> </span><span style="">uDirLightViewProjMatrix</span><span style="">;</span><span style="">
</span><span style=""></span><span style="color:#66d9ef">uniform</span><span style=""> </span><span style="color:#66d9ef">sampler2DShadow</span><span style=""> </span><span style="">uDirLightShadowMap</span><span style="">;</span><span style="">
</span><span style=""></span><span style="color:#66d9ef">uniform</span><span style=""> </span><span style="color:#66d9ef">float</span><span style=""> </span><span style="">uDirLightShadowMapBias</span><span style="">;</span></code></pre>
</div>
<p>Puis remplacez le code de calcul de la visibilité par:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-glsl" data-lang="glsl"><span style="color:#66d9ef">vec4</span><span style=""> </span><span style="">positionInDirLightScreen</span><span style=""> </span><span style="color:#f92672">=</span><span style=""> </span><span style="">uDirLightViewProjMatrix</span><span style=""> </span><span style="color:#f92672">*</span><span style=""> </span><span style="color:#66d9ef">vec4</span><span style="">(</span><span style="">position</span><span style="">,</span><span style=""> </span><span style="color:#ae81ff">1</span><span style="">);</span><span style=""> </span><span style="color:#75715e">// Compute fragment position in NDC space of light</span><span style="">
</span><span style=""></span><span style="color:#66d9ef">vec3</span><span style=""> </span><span style="">positionInDirLightNDC</span><span style=""> </span><span style="color:#f92672">=</span><span style=""> </span><span style="color:#66d9ef">vec3</span><span style="">(</span><span style="">positionInDirLightScreen</span><span style=""> </span><span style="color:#f92672">/</span><span style=""> </span><span style="">positionInDirLightScreen</span><span style="">.</span><span style="">w</span><span style="">)</span><span style=""> </span><span style="color:#f92672">*</span><span style=""> </span><span style="color:#ae81ff">0.5</span><span style=""> </span><span style="color:#f92672">+</span><span style=""> </span><span style="color:#ae81ff">0.5</span><span style="">;</span><span style=""> </span><span style="color:#75715e">// Homogeneize + put between 0 and 1</span><span style="">
</span><span style=""></span><span style="color:#66d9ef">float</span><span style=""> </span><span style="">dirLightVisibility</span><span style=""> </span><span style="color:#f92672">=</span><span style=""> </span><span style="">textureProj</span><span style="">(</span><span style="">uDirLightShadowMap</span><span style="">,</span><span style=""> </span><span style="color:#66d9ef">vec4</span><span style="">(</span><span style="">positionInDirLightNDC</span><span style="">.</span><span style="">xy</span><span style="">,</span><span style=""> </span><span style="">positionInDirLightNDC</span><span style="">.</span><span style="">z</span><span style=""> </span><span style="color:#f92672">-</span><span style=""> </span><span style="">uDirLightShadowMapBias</span><span style="">,</span><span style=""> </span><span style="color:#ae81ff">1.0</span><span style="">),</span><span style=""> </span><span style="color:#ae81ff">0.0</span><span style="">);</span></code></pre>
</div>
<p>On utilise donc un <em>sampler2DShadow</em> à la place d&rsquo;un <em>sampler2D</em> et la fonction <em>textureProj</em> à la place de <em>texture</em>. Ce code permet d&rsquo;obtenir un filtrage 2x2 (bilinéaire) sur nos ombres.</p>

<p>Afin que ce shader fonctionne, il faut rajouter deux lignes à l&rsquo;initialisation du sampler m_directionalSMSampler:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp"><span style="">glGenSamplers</span><span style="">(</span><span style="color:#ae81ff">1</span><span style="">,</span><span style=""> </span><span style="color:#f92672">&amp;</span><span style="">m_directionalSMSampler</span><span style="">);</span><span style="">
</span><span style=""></span><span style="">glSamplerParameteri</span><span style="">(</span><span style="">m_directionalSMSampler</span><span style="">,</span><span style=""> </span><span style="">GL_TEXTURE_MIN_FILTER</span><span style="">,</span><span style=""> </span><span style="">GL_LINEAR</span><span style="">);</span><span style="">
</span><span style=""></span><span style="">glSamplerParameteri</span><span style="">(</span><span style="">m_directionalSMSampler</span><span style="">,</span><span style=""> </span><span style="">GL_TEXTURE_MAG_FILTER</span><span style="">,</span><span style=""> </span><span style="">GL_LINEAR</span><span style="">);</span><span style="">
</span><span style=""></span><span style="">glSamplerParameteri</span><span style="">(</span><span style="">m_directionalSMSampler</span><span style="">,</span><span style=""> </span><span style="">GL_TEXTURE_WRAP_S</span><span style="">,</span><span style=""> </span><span style="">GL_CLAMP_TO_BORDER</span><span style="">);</span><span style="">
</span><span style=""></span><span style="">glSamplerParameteri</span><span style="">(</span><span style="">m_directionalSMSampler</span><span style="">,</span><span style=""> </span><span style="">GL_TEXTURE_WRAP_T</span><span style="">,</span><span style=""> </span><span style="">GL_CLAMP_TO_BORDER</span><span style="">);</span><span style="">
</span><span style=""></span><span style="">glSamplerParameteri</span><span style="">(</span><span style="">m_directionalSMSampler</span><span style="">,</span><span style=""> </span><span style="">GL_TEXTURE_COMPARE_MODE</span><span style="">,</span><span style=""> </span><span style="">GL_COMPARE_REF_TO_TEXTURE</span><span style="">);</span><span style=""> </span><span style="color:#75715e">// Cette ligne
</span><span style="color:#75715e"></span><span style="">glSamplerParameteri</span><span style="">(</span><span style="">m_directionalSMSampler</span><span style="">,</span><span style=""> </span><span style="">GL_TEXTURE_COMPARE_FUNC</span><span style="">,</span><span style=""> </span><span style="">GL_LEQUAL</span><span style="">)</span><span style=""> </span><span style="color:#f92672">//</span><span style=""> </span><span style="">Et</span><span style=""> </span><span style="">celle</span><span style=""> </span><span style="">ci</span><span style="">;</span></code></pre>
</div>
<p>Ces lignes définissent le comportement de la fonction <em>textureProj</em> dans le shader.</p>

<p>Une fois ces modifications effectuées, lancez votre application et constatez que les ombres sont un peu floutées.</p>

<h2 id="arbitraire">Arbitraire</h2>

<p>Il est possible d&rsquo;allouer plus loin dans le filtrage des ombres en appliquant un filtre arbitraire lors de la lecture de la shadow map. Cela est plus couteux mais également plus agréable visuellement.</p>

<p>Dans <em>shadingPass.fs.glsl</em>, ajoutez les uniform:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-glsl" data-lang="glsl"><span style="color:#66d9ef">uniform</span><span style=""> </span><span style="color:#66d9ef">int</span><span style=""> </span><span style="">uDirLightShadowMapSampleCount</span><span style="">;</span><span style="">
</span><span style=""></span><span style="color:#66d9ef">uniform</span><span style=""> </span><span style="color:#66d9ef">float</span><span style=""> </span><span style="">uDirLightShadowMapSpread</span><span style="">;</span></code></pre>
</div>
<p>et le code utilitaires (avant le main):</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-glsl" data-lang="glsl"><span style="color:#66d9ef">vec2</span><span style=""> </span><span style="">poissonDisk</span><span style="">[</span><span style="color:#ae81ff">16</span><span style="">]</span><span style=""> </span><span style="color:#f92672">=</span><span style=""> </span><span style="color:#66d9ef">vec2</span><span style="">[](</span><span style="">
</span><span style="">    </span><span style="color:#66d9ef">vec2</span><span style="">(</span><span style=""> </span><span style="color:#f92672">-</span><span style="color:#ae81ff">0.94201624</span><span style="">,</span><span style=""> </span><span style="color:#f92672">-</span><span style="color:#ae81ff">0.39906216</span><span style=""> </span><span style="">),</span><span style="">
</span><span style="">    </span><span style="color:#66d9ef">vec2</span><span style="">(</span><span style=""> </span><span style="color:#ae81ff">0.94558609</span><span style="">,</span><span style=""> </span><span style="color:#f92672">-</span><span style="color:#ae81ff">0.76890725</span><span style=""> </span><span style="">),</span><span style="">
</span><span style="">    </span><span style="color:#66d9ef">vec2</span><span style="">(</span><span style=""> </span><span style="color:#f92672">-</span><span style="color:#ae81ff">0.094184101</span><span style="">,</span><span style=""> </span><span style="color:#f92672">-</span><span style="color:#ae81ff">0.92938870</span><span style=""> </span><span style="">),</span><span style="">
</span><span style="">    </span><span style="color:#66d9ef">vec2</span><span style="">(</span><span style=""> </span><span style="color:#ae81ff">0.34495938</span><span style="">,</span><span style=""> </span><span style="color:#ae81ff">0.29387760</span><span style=""> </span><span style="">),</span><span style="">
</span><span style="">    </span><span style="color:#66d9ef">vec2</span><span style="">(</span><span style=""> </span><span style="color:#f92672">-</span><span style="color:#ae81ff">0.91588581</span><span style="">,</span><span style=""> </span><span style="color:#ae81ff">0.45771432</span><span style=""> </span><span style="">),</span><span style="">
</span><span style="">    </span><span style="color:#66d9ef">vec2</span><span style="">(</span><span style=""> </span><span style="color:#f92672">-</span><span style="color:#ae81ff">0.81544232</span><span style="">,</span><span style=""> </span><span style="color:#f92672">-</span><span style="color:#ae81ff">0.87912464</span><span style=""> </span><span style="">),</span><span style="">
</span><span style="">    </span><span style="color:#66d9ef">vec2</span><span style="">(</span><span style=""> </span><span style="color:#f92672">-</span><span style="color:#ae81ff">0.38277543</span><span style="">,</span><span style=""> </span><span style="color:#ae81ff">0.27676845</span><span style=""> </span><span style="">),</span><span style="">
</span><span style="">    </span><span style="color:#66d9ef">vec2</span><span style="">(</span><span style=""> </span><span style="color:#ae81ff">0.97484398</span><span style="">,</span><span style=""> </span><span style="color:#ae81ff">0.75648379</span><span style=""> </span><span style="">),</span><span style="">
</span><span style="">    </span><span style="color:#66d9ef">vec2</span><span style="">(</span><span style=""> </span><span style="color:#ae81ff">0.44323325</span><span style="">,</span><span style=""> </span><span style="color:#f92672">-</span><span style="color:#ae81ff">0.97511554</span><span style=""> </span><span style="">),</span><span style="">
</span><span style="">    </span><span style="color:#66d9ef">vec2</span><span style="">(</span><span style=""> </span><span style="color:#ae81ff">0.53742981</span><span style="">,</span><span style=""> </span><span style="color:#f92672">-</span><span style="color:#ae81ff">0.47373420</span><span style=""> </span><span style="">),</span><span style="">
</span><span style="">    </span><span style="color:#66d9ef">vec2</span><span style="">(</span><span style=""> </span><span style="color:#f92672">-</span><span style="color:#ae81ff">0.26496911</span><span style="">,</span><span style=""> </span><span style="color:#f92672">-</span><span style="color:#ae81ff">0.41893023</span><span style=""> </span><span style="">),</span><span style="">
</span><span style="">    </span><span style="color:#66d9ef">vec2</span><span style="">(</span><span style=""> </span><span style="color:#ae81ff">0.79197514</span><span style="">,</span><span style=""> </span><span style="color:#ae81ff">0.19090188</span><span style=""> </span><span style="">),</span><span style="">
</span><span style="">    </span><span style="color:#66d9ef">vec2</span><span style="">(</span><span style=""> </span><span style="color:#f92672">-</span><span style="color:#ae81ff">0.24188840</span><span style="">,</span><span style=""> </span><span style="color:#ae81ff">0.99706507</span><span style=""> </span><span style="">),</span><span style="">
</span><span style="">    </span><span style="color:#66d9ef">vec2</span><span style="">(</span><span style=""> </span><span style="color:#f92672">-</span><span style="color:#ae81ff">0.81409955</span><span style="">,</span><span style=""> </span><span style="color:#ae81ff">0.91437590</span><span style=""> </span><span style="">),</span><span style="">
</span><span style="">    </span><span style="color:#66d9ef">vec2</span><span style="">(</span><span style=""> </span><span style="color:#ae81ff">0.19984126</span><span style="">,</span><span style=""> </span><span style="color:#ae81ff">0.78641367</span><span style=""> </span><span style="">),</span><span style="">
</span><span style="">    </span><span style="color:#66d9ef">vec2</span><span style="">(</span><span style=""> </span><span style="color:#ae81ff">0.14383161</span><span style="">,</span><span style=""> </span><span style="color:#f92672">-</span><span style="color:#ae81ff">0.14100790</span><span style=""> </span><span style="">)</span><span style="">
</span><span style=""></span><span style="">);</span><span style="">
</span><span style="">
</span><span style=""></span><span style="color:#66d9ef">float</span><span style=""> </span><span style="">random</span><span style="">(</span><span style="color:#66d9ef">vec4</span><span style=""> </span><span style="">seed</span><span style="">)</span><span style="">
</span><span style=""></span><span style="">{</span><span style="">
</span><span style="">    </span><span style="color:#66d9ef">float</span><span style=""> </span><span style="">dot_product</span><span style=""> </span><span style="color:#f92672">=</span><span style=""> </span><span style="">dot</span><span style="">(</span><span style="">seed</span><span style="">,</span><span style=""> </span><span style="color:#66d9ef">vec4</span><span style="">(</span><span style="color:#ae81ff">12.9898</span><span style="">,</span><span style="color:#ae81ff">78.233</span><span style="">,</span><span style="color:#ae81ff">45.164</span><span style="">,</span><span style="color:#ae81ff">94.673</span><span style="">));</span><span style="">
</span><span style="">    </span><span style="color:#66d9ef">return</span><span style=""> </span><span style="">fract</span><span style="">(</span><span style="">sin</span><span style="">(</span><span style="">dot_product</span><span style="">)</span><span style=""> </span><span style="color:#f92672">*</span><span style=""> </span><span style="color:#ae81ff">43758.5453</span><span style="">);</span><span style="">
</span><span style=""></span><span style="">}</span></code></pre>
</div>
<p>Le tableau poissonDisk definit 16 échantillons d&rsquo;une distribution de poisson 2D centrée en (0,0). La fonction random permet d&rsquo;obtenir un nombre pseudo-aléatoire à partir d&rsquo;une graine.</p>

<p>Dans le main du shader, remplacez le calcul de la visibilité par:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-glsl" data-lang="glsl"><span style="color:#66d9ef">float</span><span style=""> </span><span style="">dirLightVisibility</span><span style=""> </span><span style="color:#f92672">=</span><span style=""> </span><span style="color:#ae81ff">0.0</span><span style="">;</span><span style="">
</span><span style=""></span><span style="color:#66d9ef">float</span><span style=""> </span><span style="">dirSampleCountf</span><span style=""> </span><span style="color:#f92672">=</span><span style=""> </span><span style="color:#66d9ef">float</span><span style="">(</span><span style="">uDirLightShadowMapSampleCount</span><span style="">);</span><span style="">
</span><span style=""></span><span style="color:#66d9ef">int</span><span style=""> </span><span style="">step</span><span style=""> </span><span style="color:#f92672">=</span><span style=""> </span><span style="">max</span><span style="">(</span><span style="color:#ae81ff">1</span><span style="">,</span><span style=""> </span><span style="color:#ae81ff">16</span><span style=""> </span><span style="color:#f92672">/</span><span style=""> </span><span style="">uDirLightShadowMapSampleCount</span><span style="">);</span><span style="">
</span><span style=""></span><span style="color:#66d9ef">for</span><span style=""> </span><span style="">(</span><span style="color:#66d9ef">int</span><span style=""> </span><span style="">i</span><span style=""> </span><span style="color:#f92672">=</span><span style=""> </span><span style="color:#ae81ff">0</span><span style="">;</span><span style=""> </span><span style="">i</span><span style=""> </span><span style="color:#f92672">&lt;</span><span style=""> </span><span style="">uDirLightShadowMapSampleCount</span><span style="">;</span><span style=""> </span><span style="color:#f92672">++</span><span style="">i</span><span style="">)</span><span style="">
</span><span style=""></span><span style="">{</span><span style="">
</span><span style="">    </span><span style="color:#75715e">// Noisy shadows:</span><span style="">
</span><span style="">    </span><span style="color:#66d9ef">int</span><span style=""> </span><span style="">index</span><span style=""> </span><span style="color:#f92672">=</span><span style=""> </span><span style="color:#66d9ef">int</span><span style="">(</span><span style="">dirSampleCountf</span><span style=""> </span><span style="color:#f92672">*</span><span style=""> </span><span style="">random</span><span style="">(</span><span style="color:#66d9ef">vec4</span><span style="">(</span><span style="">gl_FragCoord</span><span style="">.</span><span style="">xyy</span><span style="">,</span><span style=""> </span><span style="">i</span><span style="">)))</span><span style=""> </span><span style="color:#f92672">%</span><span style=""> </span><span style="">uDirLightShadowMapSampleCount</span><span style="">;</span><span style="">
</span><span style="">
</span><span style="">    </span><span style="">dirLightVisibility</span><span style=""> </span><span style="color:#f92672">+=</span><span style=""> </span><span style="">textureProj</span><span style="">(</span><span style="">uDirLightShadowMap</span><span style="">,</span><span style=""> </span><span style="color:#66d9ef">vec4</span><span style="">(</span><span style="">positionInDirLightNDC</span><span style="">.</span><span style="">xy</span><span style=""> </span><span style="color:#f92672">+</span><span style=""> </span><span style="">uDirLightShadowMapSpread</span><span style=""> </span><span style="color:#f92672">*</span><span style=""> </span><span style="">poissonDisk</span><span style="">[</span><span style="">index</span><span style="">],</span><span style=""> </span><span style="">positionInDirLightNDC</span><span style="">.</span><span style="">z</span><span style=""> </span><span style="color:#f92672">-</span><span style=""> </span><span style="">uDirLightShadowMapBias</span><span style="">,</span><span style=""> </span><span style="color:#ae81ff">1.0</span><span style="">),</span><span style=""> </span><span style="color:#ae81ff">0.0</span><span style="">);</span><span style="">
</span><span style=""></span><span style="">}</span><span style="">
</span><span style=""></span><span style="">dirLightVisibility</span><span style=""> </span><span style="color:#f92672">/=</span><span style=""> </span><span style="">dirSampleCountf</span><span style="">;</span></code></pre>
</div>
<p>Dans le code de l&rsquo;application, faites en sorte de pouvoir setter les deux nouvelles uniforms uDirLightShadowMapSampleCount et uDirLightShadowMapSpread via la GUI. La variable uDirLightShadowMapSpread doit être relativement petite (de l&rsquo;ordre de 0.0005) afin de ne pas trop disperser les ombres.</p>

<p>Essayez ce code. Il devrait vous donner des ombres bruitées mais douces.</p>

<p>Une alternative pour obtenir des ombres floutées plutot que bruitées est de calculer l&rsquo;index dans la boucle avec:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-glsl" data-lang="glsl"><span style="color:#75715e">// Blurred shadows:</span><span style="">
</span><span style=""></span><span style="color:#66d9ef">int</span><span style=""> </span><span style="">index</span><span style=""> </span><span style="color:#f92672">=</span><span style=""> </span><span style="">(</span><span style="">i</span><span style=""> </span><span style="color:#f92672">+</span><span style=""> </span><span style="">step</span><span style="">)</span><span style=""> </span><span style="color:#f92672">%</span><span style=""> </span><span style="">uDirLightShadowMapSampleCount</span><span style="">;</span></code></pre>
</div>
        </div>

        <div class="col side-menu side-menu-right page-content">
            <div class="toc-sidebar">
<nav id="TableOfContents">
<ul>
<li><a href="#percentage-closest-filtering">Percentage Closest Filtering</a>
<ul>
<li><a href="#basique">Basique</a></li>
<li><a href="#arbitraire">Arbitraire</a></li>
</ul></li>
</ul>
</nav>
</div>
        </div>
    </div>
</div>

</main>



<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.3/js/bootstrap.min.js" integrity="sha384-a5N7Y/aK3qNeh15eJKGWxsqtnX/wWdSZSKp+81YjTmS15nvnvxKHuzaWwXHDli+4" crossorigin="anonymous"></script>

<script>
$(".toc-sidebar ul").addClass("nav flex-column");
$(".toc-sidebar li").addClass("nav-item");
$(".toc-sidebar a").addClass("nav-link");
</script>



</body>
</html>